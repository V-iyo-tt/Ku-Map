<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="referrer" content="origin">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Naver Map (Fixed Coordinates)</title>
  <style>
    html, body, #map { height: 100%; margin: 0; padding: 0; }
    body { overflow: hidden; } 
    .hud {
      position: fixed; left: 8px; bottom: 8px;
      background: rgba(0, 0, 0, 0.6); color: #fff;
      padding: 6px 10px; border-radius: 8px;
      font: 12px/1.3 system-ui, -apple-system, sans-serif;
      z-index: 1000; pointer-events: none;
    }
  </style>
  <script>
    const DEFAULT_CID = "pu0ce4kfq8"; 
    let map;

    // ===========================================
    // ★★★ [좌표 설정 구역] ★★★
    const FIXED_LAT = 37.58361;  
    const FIXED_LNG = 127.02528; 
    // ===========================================

    // [핵심] HTML이 다 로드될 때까지 기다리는 함수
    function ready(fn) {
      if (document.readyState !== 'loading') {
        fn();
      } else {
        document.addEventListener('DOMContentLoaded', fn);
      }
    }

    // 네이버 API가 로드된 후 실행되는 함수
    window.initMap = function() {
        // ★ 여기서 ready()를 써서 안전하게 실행합니다!
        ready(function() {
            function hud(msg){
                let h = document.querySelector('.hud');
                if(!h){ 
                    h = document.createElement('div'); 
                    h.className = 'hud'; 
                    document.body.appendChild(h); 
                }
                h.textContent = msg;
            }

            // 1. 위치 객체 생성
            const targetLocation = new naver.maps.LatLng(FIXED_LAT, FIXED_LNG);

            // 2. 맵 생성 (이제 <div id="map">이 확실히 존재함)
            map = new naver.maps.Map('map', {
                center: targetLocation,
                zoom: 17,
                scaleControl: false,
                logoControl: false,
                mapDataControl: false,
                zoomControl: false
            });

            // 3. 마커 생성
            new naver.maps.Marker({
                position: targetLocation,
                map: map
            });

            hud(`위치 설정: ${FIXED_LAT}, ${FIXED_LNG}`);

            // Unity 통신 객체
            window.UnityMap = {
                setCenter: (la, ln) => { map.setCenter(new naver.maps.LatLng(la, ln)); },
                updateMyLocation: (la, ln) => { /* ... */ }
            };
        });
    };

    (function(){
        const qs = new URLSearchParams(location.search);
        const cid = (qs.get('cid') || DEFAULT_CID).trim();
        
        const s = document.createElement('script');
        s.src = 'https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=' + encodeURIComponent(cid) + '&callback=initMap';
        document.head.appendChild(s);
    })();
  </script>
</head>
<body>
  <div id="map"></div>
</body>
</html>